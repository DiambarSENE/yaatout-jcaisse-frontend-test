version: '3.8'
services:
  # registry-service:
  #   image: diambarsene/yaatout-registry-v1:v1 
  #   container_name: yaatout-registry-v1
  #   restart: always
  #   ports:
  #     - '8762:8761'
  #   healthcheck:
  #     test: [ "CMD", "curl", "-f", "http://localhost:8761/actuator/health" ]
  #     interval: 1m
  #     timeout: 10s
  #     retries: 4
  #   networks:
  #   - yaatout-network 

  # config-service:
  #   image: diambarsene/yaatout-config-service:v1 
  #   container_name: yaatout-config-service
  #   restart: always
  #   ports:
  #     - '8889:8888'
  #   environment:
  #     - DISCOVERY_SERVICE_URL=http://registry-service:8761/eureka
  #   healthcheck:
  #     test: [ "CMD", "curl", "-f", "http://localhost:8888/actuator/health" ]
  #     interval: 2m
  #     timeout: 10s
  #     retries: 5
  #   depends_on:
  #     registry-service:
  #       condition: service_healthy  
  #   networks:
  #   - yaatout-network    

  app-parametres-api:
    container_name: yaatout-parametres-api
    image: diambarsene/yaatout-parametre-api:v01 
    restart: always
    ports:
      - "8084:8084"
    # environment:
    #   - DISCOVERY_SERVICE_URL=http://registry-service:8761/eureka
    #   - CONFIG_SERVICE_URL=http://config-service:8888
    healthcheck:
      # test: [ "CMD", "curl", "-f", "http://localhost:8084/actuator/health" ]
      interval: 2m
      timeout: 10s
      retries: 8
    depends_on:
      - db_parametres_api
      #   condition: service_healthy
      # config-service:
      #   condition: service_healthy 
    networks:
    - yaatout-jcaisse-deux-network   

  db_parametres_api:
    container_name: db_parametres_api
    image: mysql:8
    environment:
      MYSQL_ROOT_PASSWORD: sene
      MYSQL_DATABASE: Jcaisse_paramettre
      MYSQL_USER: sene #utilisateur_db_user
      MYSQL_PASSWORD: sene #utilisateur_db_password
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]
      interval: 2m
      timeout: 10s
      retries: 5  
    ports:
      - "3307:3306"
    volumes:
      - parametres-db-data:/var/lib/mysql
    networks:
    - yaatout-jcaisse-deux-network  
  
  app-users-api:
    container_name: yaatout-users-api 
    image: diambarsene/yaatout-jcaisse-users-api:v01 #nom-image-utilisateur:version
    restart: always 
    ports:
      - "8283:8283"
    # environment:
    #   - DISCOVERY_SERVICE_URL=http://registry-service:8761/eureka
    #   - CONFIG_SERVICE_URL=http://config-service:8888
    depends_on:
      - db_utilisateurs_api_deux
    networks:
    - yaatout-jcaisse-deux-network  

  db_utilisateurs_api_deux:
    container_name: db_utilisateurs_api_deux
    image: mysql:8
    environment:
      MYSQL_ROOT_PASSWORD: sene
      MYSQL_DATABASE: Jcaisse_utilisateurs_deux
      MYSQL_USER: sene
      MYSQL_PASSWORD: sene
    ports:
      - "3308:3306"
    volumes:
      - users-db-data-v2:/var/lib/mysql   # <-- nouveau volume
      # - users-db-data:/var/lib/mysql
    networks:
    - yaatout-jcaisse-deux-network  

  # yaatout-proxy-api:
  #   image: diambarsene/yaatout-proxy-service:v1     
  #   container_name: yaatout-proxy-api
  #   restart: always
  #   ports:
  #     - "9999:9999"
  #   environment:
  #     - DISCOVERY_SERVICE_URL=http://registry-service:8761/eureka
  #     - CONFIG_SERVICE_URL=http://config-service:8888
  #   healthcheck:
  #     test: [ "CMD", "curl", "-f", "http://localhost:9999/actuator/health" ]
  #     interval: 2m
  #     timeout: 10s
  #     retries: 8
  #   depends_on:
  #     config-service:
  #       condition: service_healthy
  #   networks:
  #   - yaatout-network    

  frontend:
    container_name: yaatout-jcaisse-frontend
    image: diambarsene/jcaisse-frontend-version-deux:v2 
    restart: always
    ports:
      - '8081:80'
    # depends_on:
    #   yaatout-proxy-api:
    #     condition: service_healthy    
    networks:
    - yaatout-jcaisse-deux-network

volumes:
  parametres-db-data:
  users-db-data-v2:
  # users-db-data:

networks:
  yaatout-jcaisse-deux-network:
    driver: bridge




